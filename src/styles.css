:root {
    --bg: #0f172a;
    --panel: #111827;
    --card: #1f2937;
    --ink: #e5e7eb;
    --muted: #9ca3af;
    --accent: #22c55e
}

* {
    box-sizing: border-box
}

html, body, #root {
    height: 100%
}

body {
    margin: 0;
    background: var(--bg);
    color: var(--ink);
    font-family: Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif
}

a {
    color: inherit
}

/* Layout: widen left, keep deck width, prevent overlap */
.app {
    display: grid;
    grid-template-columns: 320px 1fr 360px; /* left a bit wider */
    gap: 12px;
    align-items: start;
    /* let the page/viewport handle scrolling so sticky works */
    min-height: 100vh;
}

/* Side panels */
.left, .right {
    background: var(--panel);
    padding: 12px;
    border-radius: 12px;
    overflow: auto; /* scroll inside the panel */
    -webkit-overflow-scrolling: touch;
}

.left {
    position: sticky; /* stay visible while page scrolls */
    top: 8px; /* small breathing room from top */
    z-index: 2; /* ensure above grid hover effects */
    max-height: calc(100vh - 16px);
}

.right {
    position: sticky;
    top: 8px;
    max-height: calc(100vh - 16px);
}

/* Card grid */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(230px,1fr));
    gap: 12px;
    /* Make gallery scroll independently and give its scrollbar a tiny gutter */
    max-height: calc(100vh - 16px);
    overflow: auto;
    padding-right: 10px; /* internal gutter so its scrollbar sits left of the deck panel’s scrollbar */
    scrollbar-gutter: stable both-edges; /* reserve space to prevent layout shifts when scrollbar appears */

    position: relative;
    z-index: 1; /* below the left panel */
    min-width: 0; /* prevents grid from pushing into sidebars */
    -webkit-overflow-scrolling: touch;
}

/* Cards */
.card {
    background: var(--card);
    border-radius: 12px;
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 6px
}

    .card h4 {
        margin: 0;
        font-size: 14px
    }

.row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap
}

/* Controls: bigger inputs/selects */
.controls {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px
}

input, select {
    background: #0b1220;
    border: 1px solid #263143;
    color: var(--ink);
    padding: 8px 10px; /* larger padding */
    height: 36px; /* taller boxes */
    font-size: 14px; /* slightly larger text */
    border-radius: 8px;
    width: 100%;
}

button, .btn {
    background: #0b1220;
    border: 1px solid #263143;
    color: var(--ink);
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
}

/* Hide the real file input but keep it accessible */
.file-input-visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0 0 0 0);
    white-space: nowrap;
    border: 0;
}

/* Filename next to the button */
.file-row .file-name {
    font-size: 12px;
    color: var(--muted);
    margin-left: 8px;
    max-width: 200px; /* keep it tidy */
    overflow: hidden;
    text-overflow: ellipsis; /* … */
    white-space: nowrap;
    opacity: 0.9;
}

.badge {
    background: #0b1220;
    border: 1px solid #263143;
    border-radius: 999px;
    padding: 2px 8px;
    font-size: 12px;
    color: var(--muted)
}

img.cardart {
    width: 100%;
    aspect-ratio: 3/4;
    object-fit: cover;
    border-radius: 8px;
    background: #000
}

.small {
    font-size: 12px;
    color: var(--muted)
}

.deckRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 0;
    border-bottom: 1px dashed #263143
}

.qty {
    display: flex;
    align-items: center;
    gap: 4px
}

/* Stack layout on small screens */
@media (max-width: 1100px) {
    .app {
        grid-template-columns: 1fr;
        height: auto;
    }

    .left, .right {
        position: static;
        max-height: none;
    }
}

/* Highlight cards that are in the deck */
.card.in-deck {
    outline: 3px solid #f5c542; /* yellow outline */
    outline-offset: -3px; /* pull it inside so it won't clip */
    box-shadow: 0 0 0 2px rgba(0,0,0,0.18) inset; /* subtle inner depth */
    transition: outline-color 120ms ease;
}

/* (optional) keep hover working nicely */
.card:hover {
    transform: translateY(-1px);
}

/* (optional) also tint the title/badges slightly when selected */
.card.in-deck h4 {
    color: #b88600;
}

.cardart.clickable {
    cursor: pointer;
    user-select: none;
    touch-action: manipulation; /* faster taps on mobile */
}

/* ensure positioned children can sit on corners */
.card {
    position: relative;
}

    /* Gallery: banned state */
    .card.is-banned .badge {
        background: #ff4d4f !important; /* override per-badge colors */
        border-color: #ff4d4f !important;
        color: #111 !important;
        font-weight: 700;
        box-shadow: none !important; /* remove any subtle outline */
    }

    /* “BANNED” ribbon over the card art */
    .card .ban-overlay {
        display: none; /* only show when banned */
        position: absolute;
        left: 8px;
        right: 8px;
        top: 30%;
        transform: rotate(-12deg);
        text-align: center;
        padding: 6px 0;
        background: rgba(255, 77, 79, 0.85); /* similar to deck highlight */
        color: #111;
        font-weight: 900;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        border-radius: 6px;
        pointer-events: none; /* don’t block clicks */
        z-index: 2;
    }

    .card.is-banned .ban-overlay {
        display: block;
    }

/* top-left deck count badge */
.deck-badge {
    position: absolute;
    top: 6px;
    left: 6px;
    min-width: 33px;      /* was 22px → +50% */
    height: 33px;         /* was 22px → +50% */
    padding: 0 9px;       /* was 0 6px → +50% */
    border-radius: 999px;
    background: #f5c542;
    color: #1a1a1a;
    font-weight: 700;
    font-size: 18px;      /* was 12px → +50% */
    line-height: 33px;    /* was 22px → +50% */
    text-align: center;
    box-shadow: 0 1px 2px rgba(0,0,0,.25);
    z-index: 2;
    cursor: pointer;
    user-select: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* Gallery: deck count badge turns red on banned cards */
.card.is-banned .deck-badge {
    background: #ff4d4f !important;
    color: #111 !important;
}

/* Gallery: softly red-tint the whole card background when banned */
.card.is-banned {
    --card: rgba(255, 77, 79, 0.12); /* soft version of the banned red */
    background: var(--card) !important;
}

    /* Gallery: action buttons turn red on banned cards */
    .card.is-banned .row > button,
    .card.is-banned .row > button:hover,
    .card.is-banned .row > button:focus {
        background: #ff4d4f !important;
        border-color: #ff4d4f !important;
        color: #111 !important;
        box-shadow: none !important;
    }

        /* Keep disabled buttons readable but clearly inactive */
        .card.is-banned .row > button[disabled] {
            opacity: 0.6;
            cursor: not-allowed;
        }

    .deck-badge:hover {
        filter: brightness(1.05);
    }

    .deck-badge:active {
        transform: scale(0.94);
    }

/* (optional) subtle pop when count appears/changes */
@media (prefers-reduced-motion: no-preference) {
    .deck-badge {
        transition: transform 120ms ease, filter 120ms ease;
    }

    .card.in-deck .deck-badge {
        transform: scale(1.0);
    }

    .card.in-deck:active .deck-badge {
        transform: scale(1.06);
        filter: brightness(1.05);
    }
}

.deck-type-header {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    border-bottom: 1px solid #263143;
    padding: 4px 0;
    user-select: none;
}

.deck-type-header:hover {
    background: rgba(255,255,255,0.04);
}

.deck-type-header .arrow {
    display: inline-block;
    margin-right: 6px;
    transition: transform 0.2s ease;
}

.deck-type-header .arrow.collapsed {
    transform: rotate(-90deg);
}

.deck-type-group + .deck-type-group {
    margin-top: 8px;
}

.deck-type-cards {
    margin-top: 4px;
}

/* Floating tooltip preview that follows the cursor */
.deck-preview-float {
    position: fixed; /* follow viewport cursor */
    width: 240px; /* PREVIEW_W */
    max-width: 240px;
    background: var(--card);
    border: 1px solid #263143;
    border-radius: 10px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.35);
    padding: 8px;
    z-index: 9999;
    pointer-events: none; /* don't block mouse */
}

.deck-preview-img {
    width: 100%;
    aspect-ratio: 3/4;
    object-fit: cover;
    border-radius: 6px;
    background: #000;
    display: block;
    margin-bottom: 8px;
}

.deck-preview-meta .name {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 4px;
}

.deck-preview-meta .line {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 6px;
}

.deck-preview-float {
    position: fixed;
    z-index: 2147483647; /* practically always on top */
}

/* tiny icon button in card's top-right */
.zoom-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 28px;
    height: 28px;
    border-radius: 999px;
    background: rgba(0,0,0,0.55);
    border: 1px solid #263143;
    color: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 3;
    padding: 0;
}

    .zoom-btn:hover {
        background: rgba(0,0,0,0.7);
    }

    .zoom-btn:active {
        transform: scale(0.96);
    }

/* modal backdrop */
.zoom-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 2147483646;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
}

/* modal content */
.zoom-modal {
    position: relative;
    max-width: min(92vw, 640px);
    max-height: min(92vh, 880px);
    background: var(--panel);
    border: 1px solid #263143;
    border-radius: 12px;
    box-shadow: 0 12px 48px rgba(0,0,0,0.45);
    padding: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* close button */
.zoom-close {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: #0b1220;
    border: 1px solid #263143;
    color: var(--ink);
    font-size: 16px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1;
}

    .zoom-close:hover {
        filter: brightness(1.1);
    }

/* zoomed image */
.zoom-img {
    width: 100%;
    height: auto;
    max-height: calc(92vh - 64px);
    object-fit: contain;
    border-radius: 8px;
    background: #000;
}

.dataset-toggle {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    margin: 8px 0 12px;
}

    .dataset-toggle .tab {
        padding: 6px 8px;
        font-weight: 600;
        border: 1px solid var(--border, #3a3a3a);
        border-radius: 6px;
        background: var(--bg2, #1f1f1f);
        cursor: pointer;
    }

        .dataset-toggle .tab.active {
            background: var(--accent, #3b82f6);
            color: white;
            border-color: var(--accent, #3b82f6);
        }

.deck-preview-float {
    pointer-events: none;
}

/* Partner section highlight in the deck list (right panel) */
.deck-type-group.is-partner {
    background-color: #f5c542; /* bright yellow-orange highlight */
    border: 1px solid #d4a017; /* slightly darker border */
    border-radius: 6px;
    color: #1a1a1a; /* white text */
}

    .deck-type-group.is-partner .deck-type-header {
        color: #1a1a1a; /* white header text */
        font-weight: 700;
    }

    .deck-type-group.is-partner .deckRow {
        color: #1a1a1a; /* white row text */
    }

        .deck-type-group.is-partner .deckRow .small {
            color: #1a1a1a; /* slightly softer white for secondary text */
        }

/* 1) Keep the red highlight */
.deckRow.not-allowed {
    background: #3a0e12; /* darker maroon for dark theme */
    border-left: 4px solid #ff4d4f;
}

    /* 2) Make the text readable on that darker background */
    /* Target typical text nodes but avoid clobbering buttons/badges */
    .deckRow.not-allowed,
    .deckRow.not-allowed .small,
    .deckRow.not-allowed > div,
    .deckRow.not-allowed > div *:not(button):not(.badge):not(.warn) {
        color: #fff !important;
    }

/* 3) Warning badge stays high-contrast and obvious */
.badge.warn {
    background: #ff4d4f;
    color: #111; /* dark text on bright badge */
    font-weight: 700;
}

/* State coverage so highlight doesn't wash out colors */
.deckRow.not-allowed:hover,
.deckRow.not-allowed.is-active,
.deckRow.not-allowed.is-selected,
.deckRow.not-allowed[aria-selected="true"],
.deckRow.not-allowed:focus,
.deckRow.not-allowed:focus-visible {
    background: #3a0e12; /* same maroon as base */
    outline: 2px solid #ff9aa0; /* subtle focus outline for keyboard users */
    outline-offset: 2px;
}

/* Ensure links and icons remain readable on the dark background */
.deckRow.not-allowed a,
.deckRow.not-allowed a:visited,
.deckRow.not-allowed svg {
    color: #fff !important;
    fill: currentColor;
}

/* If your rows use CSS variables for text, nudge them toward light on this background */
.deckRow.not-allowed {
    --text-color: #fff;
    --muted-text-color: #f3f3f3;
}

.allowable-toggle {
    flex: 1;
    font-weight: 600;
    border: 1px solid var(--border, #3a3a3a);
    border-radius: 6px;
    background: var(--bg2, #1f1f1f);
    color: var(--ink);
    transition: background 0.15s ease, color 0.15s ease;
}

    .allowable-toggle.active {
        background: var(--accent, #3b82f6);
        color: #fff;
    }

/* left-panel stat rows */
.controls .filter-label {
    min-width: 60px;
}

.controls .filter-input {
    width: 80px;
}

/* Bounds rows: label + up to 3 inputs fit the panel with gaps */
.controls.bounds-row {
    display: grid;
    grid-template-columns: max-content minmax(0,1fr) minmax(0,1fr) minmax(0,1fr);
    gap: 8px;
    align-items: center;
}

    /* Let the boxes shrink/grow without overlap */
    .controls.bounds-row .filter-input {
        width: 100%;
        min-width: 0;
    }

    /* The single wide text input (e.g., “Cost string contains…”) spans all input columns */
    .controls.bounds-row input.filter-input[type="text"] {
        grid-column: 2 / -1;
    }

/* Tips button */
.tips-btn {
    padding: 8px 14px; /* was 6px 10px */
    border: 1px solid #263143;
    border-radius: 6px;
    background: rgba(255,255,255,0.05);
    color: var(--ink);
    font-size: 17px; /* was 14px */
    cursor: pointer;
}

    .tips-btn:hover {
        background: rgba(255,255,255,0.1);
    }

/* Modal backdrop */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

/* Modal window */
.modal-window {
    background: var(--panel);
    color: var(--ink);
    border-radius: 10px;
    width: 720px;
    max-width: 92vw;
    font-size: 16px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid #263143;
    box-shadow: 0 10px 30px rgba(0,0,0,0.35);
}

/* Header */
.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    background: rgba(255,255,255,0.05);
    border-bottom: 1px solid #263143;
}

    .modal-header h2 {
        margin: 0;
    }

/* Close button */
.modal-close {
    background: none;
    border: none;
    color: var(--ink);
    font-size: 22px;
    line-height: 1;
    cursor: pointer;
}

/* Body */
.modal-body {
    padding: 12px;
    font-size: 16px;
    line-height: 1.5;
    overflow-y: auto;
}

/* Modal search bar */
.modal-search {
    margin-bottom: 12px;
}

    .modal-search input {
        width: 100%;
    }

    .modal-body li {
        margin-bottom: 12px; /* more space between tips */
        font-size: 16px; /* larger text */
        line-height: 1.5; /* easier reading */
    }
.modal-header h2 {
    font-size: 20px; /* larger header text */
}

/* ===== Keywords modal table ===== */
.keywords-table-wrap {
    max-height: 60vh; /* keep it readable */
    overflow: auto; /* scroll if it grows */
    border: 1px solid #263143;
    border-radius: 8px;
}

.keywords-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

    .keywords-table thead th {
        position: sticky; /* header stays visible while scrolling */
        top: 0;
        background: var(--panel); /* opaque so rows don’t show through */
        border-bottom: 1px solid #263143;
        text-align: left;
        padding: 10px;
        z-index: 3; /* stay above table body cells */
        white-space: nowrap; /* prevent header labels from wrapping */
    }

    .keywords-table th,
    .keywords-table td {
        padding: 10px;
        vertical-align: top;
        border-bottom: 1px solid #263143;
    }

    .keywords-table td {
        color: var(--ink);
        /* allow long rules text to wrap cleanly */
        white-space: normal;
        word-break: break-word;
    }

/* Wider layout specifically for the Keywords modal */
.modal-window.modal-keywords {
    width: 1100px; /* was 720px via .modal-window */
    max-width: 96vw; /* use more of the viewport */
}

/* Make the Name column wider in the Keywords table */
.keywords-table th:first-child,
.keywords-table td:first-child {
    width: 10%; /* tweak as you like: 25–35% works well */
    min-width: 175px; /* keeps it readable on narrower screens */
}

/* Make the Templating column wider in the Keywords table */
.keywords-table th:nth-child(2),
.keywords-table td:nth-child(2) {
    width: 15%; 
    min-width: 220px; 
}

/* ===== Effect Icons modal ===== */
.modal-window.modal-icons {
    width: 1100px; /* roomy like the Keywords modal */
    max-width: 96vw;
}

/* Table container with scroll + sticky headers */
.icons-table-wrap {
    max-height: 60vh;
    overflow: auto;
    border: 1px solid #263143;
    border-radius: 8px;
}

.icons-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

    .icons-table thead th {
        position: sticky;
        top: 0;
        background: var(--panel); /* opaque so rows don’t show through */
        border-bottom: 1px solid #263143;
        text-align: left;
        padding: 10px;
        z-index: 3;
    }

    .icons-table th,
    .icons-table td {
        padding: 10px;
        vertical-align: top;
        border-bottom: 1px solid #263143;
        color: var(--ink);
    }

        .icons-table th:nth-child(2),
        .icons-table td:nth-child(2) {
            width: 200px; /* room for 80px icons */
            min-width: 200px;
            text-align: center;
        }

/* Keep <td> as a true table-cell to avoid collapsed-border misalignment */
.icons-cell-img {
    text-align: center;
    line-height: 0; /* removes baseline gap under images */
}

.icon-img {
    max-height: 80px; /* doubled from 40px */
    width: auto;
    display: inline-block;
    image-rendering: auto;
}

/* ===== Element Chart modal ===== */
.modal-window.modal-elements {
    width: 1100px; /* match other data modals */
    max-width: 96vw;
}

/* Table container with scroll + sticky headers */
.elements-table-wrap {
    max-height: 60vh;
    overflow: auto;
    border: 1px solid #263143;
    border-radius: 8px;
}

.elements-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

    .elements-table thead th {
        position: sticky;
        top: 0;
        background: var(--panel); /* opaque so rows don’t show through */
        border-bottom: 1px solid #263143;
        text-align: left;
        padding: 10px;
        z-index: 3;
    }

    .elements-table th,
    .elements-table td {
        padding: 10px;
        vertical-align: top;
        border-bottom: 1px solid #263143;
        color: var(--ink);
    }

        /* Image column sizing + centering (80px-tall icons) */
        .elements-table th:nth-child(2),
        .elements-table td:nth-child(2) {
            width: 200px;
            min-width: 200px;
            text-align: center;
        }

/* Room for 80px icons in Strong Against / Weak To */
.elements-table th:nth-child(3),
.elements-table td:nth-child(3),
.elements-table th:nth-child(4),
.elements-table td:nth-child(4) {
    min-width: 220px;
}

/* Keep <td> as a real table cell (no flex) to avoid border misalignment */
.elements-cell-img {
    text-align: center;
    line-height: 0; /* removes baseline gap under images */
}

.element-img {
    max-height: 80px; /* match the Effect Icons size for consistency */
    width: auto;
    display: inline-block;
    image-rendering: auto;
}

/* Icons list inside Strong Against / Weak To cells */
.elements-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
}

.elements-list-cell {
    vertical-align: middle; /* aligns icons nicely with the row */
}

.element-mini {
    max-height: 80px; /* match the Image column size */
    width: auto;
    display: inline-block;
    image-rendering: auto;
}

/* Turn Structure modal */
.modal-window.modal-turn {
    width: 760px;
    max-width: 92vw;
}

/* Section headings like big headers in screenshot */
.turn-section-title {
    font-size: 28px;
    font-weight: 800;
    letter-spacing: 0.2px;
    margin: 12px 0 6px;
}

/* Bullet list styled with star marker */
.turn-list,
.turn-sublist {
    list-style: none;
    padding-left: 0;
    margin: 0 0 14px 0;
}

    .turn-list > li {
        position: relative;
        padding-left: 18px;
        margin: 8px 0;
        font-size: 18px;
    }

        .turn-list > li::before {
            content: "*";
            position: absolute;
            left: 0;
            top: 0;
            font-weight: 900;
        }

    .turn-sublist > li {
        position: relative;
        padding-left: 18px;
        margin: 6px 0 6px 18px; /* indent sub-steps */
        font-size: 16px;
        opacity: 0.95;
    }

        .turn-sublist > li::before {
            content: "*";
            position: absolute;
            left: 0;
            top: 0;
            font-weight: 900;
        }

/* Bold step names; normal weight for descriptions */
.turn-step-name {
    font-weight: 800;
}

.turn-step-desc {
    font-weight: 400;
}

/* --- Card Layout modal --- */
.modal-cardlayout {
    width: min(1040px, 94vw);
    max-height: 86vh;
}

.card-layout-title {
    text-align: center;
    margin: 0 0 10px;
    text-decoration: underline;
}

.card-layout-figure {
    position: relative;
    width: 100%;
    display: grid;
    place-items: center;
    margin: 0 0 14px;
}

.card-layout-img {
    width: min(560px, 70vw);
    height: auto;
    display: block;
    border-radius: 8px;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset;
}

/* Number bubbles over the image */
.cl-bubble {
    position: absolute;
    transform: translate(-50%, -50%);
    width: 34px;
    height: 34px;
    border-radius: 50%;
    display: grid;
    place-items: center;
    font-weight: 700;
    background: var(--chip-bg, #1f2937);
    color: var(--chip-fg, #fff);
    box-shadow: 0 0 0 2px rgba(255,255,255,0.12), 0 2px 10px rgba(0,0,0,0.45);
    user-select: none;
    pointer-events: none; /* purely decorative */
}

/* List below the figure */
.card-layout-list {
    margin: 8px 2px 0;
    padding-left: 1.25rem;
    line-height: 1.45;
}

    .card-layout-list > li {
        margin-bottom: 8px;
    }

.card-layout-sublist {
    margin-top: 6px;
    padding-left: 1.25rem;
}

.cl-num {
    font-weight: 700;
    margin-right: 4px;
}

.cl-title {
    font-weight: 700;
    text-decoration: underline;
}
/* --- Card Layout: pull numbered balloons tight to the image --- */
.cardlayout-stage {
  /* Make the positioning container match the image size */
  display: inline-block;
  position: relative;
  margin: 0 auto;

  /* How far the bubbles sit from the image edge */
  --bubble-gap: 12px;         /* was much larger before */
  --bubble-size: 32px;        /* keep in sync with your design */
}

.cardlayout-stage img.cardlayout-img {
  display: block;             /* removes stray inline gaps */
  height: auto;
}

/* Generic bubble styles (keeps what you had, but included here for clarity) */
.card-bubble {
  position: absolute;
  width: var(--bubble-size);
  height: var(--bubble-size);
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  background: rgba(255,255,255,.08);
  border: 2px solid rgba(255,255,255,.28);
  box-shadow: 0 2px 6px rgba(0,0,0,.4);
  backdrop-filter: blur(2px);
}

/* Hug the image edge */
.card-bubble.left  { left:  calc(-1 * var(--bubble-gap)); }
.card-bubble.right { right: calc(-1 * var(--bubble-gap)); }

/* Positions (percent-based so it scales with the image) */
.card-bubble.b1 { top:  2.5%; }   /* Card Name           – left  */
.card-bubble.b2 { top:  2.5%; }   /* Refund              – right */
.card-bubble.b3 { top: 12.0%; }   /* Resource Cost       – left  */
.card-bubble.b4 { top: 39.0%; }   /* Artwork             – left  */
.card-bubble.b5 { top: 56.5%; }   /* Elemental Type pip  – right */
.card-bubble.b6 { top: 60.5%; }   /* Card Type           – left  */
.card-bubble.b7 { top: 64.5%; }   /* Rarity              – right */
.card-bubble.b8 { top: 73.5%; }   /* Text Box            – left  */
.card-bubble.b9 { bottom: 1.6%; } /* Card Stats          – right */

/* Uniform section headers (Filters, Help Section, etc.) */
.section-title {
    margin: 8px 0 10px;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    padding-bottom: 6px;
    border-bottom: 1px solid #263143; /* subtle divider */
}

/* Tighten spacing after a section title */
.left .section-title + .controls,
.left .section-title + .dataset-toggle {
    margin-top: 6px;
}
/* Right panel: tighten spacing after headings */
.right .section-title + .row {
    margin-top: 6px;
}

/* ===== Deck Stats modal ===== */
.modal-window.modal-stats {
    width: 1100px;
    max-width: 96vw;
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.chart-card {
    background: var(--card);
    border-radius: 10px;
    padding: 12px;
}

.chart-title {
    margin: 0 0 8px 0;
    font-weight: 700;
    font-size: 18px;
}

.chart-span-2 {
    grid-column: span 2;
}

/* canvas display */
.chart-canvas {
    width: 100%;
    height: 240px; /* logical pixels; canvas scales for DPR inside components */
    display: block;
}

/* legend */
.chart-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
    font-size: 13px;
    color: var(--muted);
}

.chart-key {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 2px 6px;
    background: rgba(255,255,255,0.04);
    border-radius: 6px;
}

.chart-swatch {
    width: 10px;
    height: 10px;
    border-radius: 2px;
}

/* Responsive: single column on narrow widths */
@media (max-width: 980px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .chart-span-2 {
        grid-column: span 1;
    }
}

/* Safari fallback (no scrollbar-gutter support yet): reserve a bit of space */
@supports not (scrollbar-gutter: stable) {
    .grid {
        padding-right: 12px;
    }
}

/* Full-viewport, responsive Stack View window */
.modal-window.modal-stack {
    width: 100vw;
    max-width: 100vw; /* no cap; stays dynamic as window resizes */
    height: 100vh; /* fill the browser height */
    max-height: 100vh; /* stay dynamic on resize */
    display: flex; /* let header sit on top, body fills rest */
    flex-direction: column;
}

.modal-window.modal-stack .modal-body {
    flex: 1 1 auto; /* grow to remaining space under header */
    min-height: 0; /* allow proper flexbox scrolling */
    overflow: auto; /* scroll stacks inside the body */
}

/* Horizontal columns like Archidekt stack view */
.stack-columns {
    display: flex;
    gap: 12px;
    padding: 4px 2px 8px;
    overflow: auto;
}

.stack-col {
    flex: 0 0 230px;
    background: var(--panel);
    border: 1px solid #263143;
    border-radius: 12px;
    padding: 8px;
}

.stack-col-header {
    font-weight: 700;
    margin-bottom: 6px;
}

/* Type sections within each cost column */
.stack-type + .stack-type {
    margin-top: 8px;
}

.stack-type-title {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    border-top: 1px solid #263143;
    padding-top: 6px;
    margin-bottom: 6px;
}

.stack-type:first-child .stack-type-title {
    border-top: none;
    padding-top: 0;
}

/* Card tiles (reuse the yellow .deck-badge) */
.stack-type-cards {
    display: grid;
    gap: 6px;
}

.stack-card {
    position: relative; /* needed for .deck-badge absolute positioning */
    background: #0b1220;
    border: 1px solid #263143;
    border-radius: 10px;
    padding: 6px;
    cursor: pointer;
}

    .stack-card:hover {
        transform: translateY(-1px);
    }

.stack-art {
    width: 100%;
    aspect-ratio: 3 / 4;
    object-fit: cover;
    border-radius: 6px;
    display: block;
    background: #000;
}

.stack-name {
    margin-top: 4px;
    line-height: 1.25;
}

/* Collapsible Filters header: keep existing look, just align text + arrow */
.filters-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Make the arrow button look unobtrusive */
.chev-btn {
    all: unset;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    line-height: 1;
    color: var(--muted);
    padding: 2px 4px;
}

    /* Rotate the arrow when expanded */
    .chev-btn .chev {
        display: inline-block;
        transition: transform 120ms ease;
        transform: rotate(0deg); /* collapsed (▸) */
    }

    .chev-btn[aria-expanded="true"] .chev {
        transform: rotate(90deg); /* expanded (▾) */
    }

/* Preserve spacing that used to rely on adjacent-sibling of .section-title */
.left .section-title + #filters-body {
    margin-top: 6px;
}

/* Flip button: same base button look; highlight when active */
.flip-btn[aria-pressed="true"] {
    background: #eab308; /* match your warn/yellow tone */
    color: #0b1220; /* readable on yellow */
    border-color: #eab308;
}

/* Constrain the popup and stack image + button vertically */
.zoom-modal {
    display: flex;
    flex-direction: column;
    max-height: 92vh; /* keep the whole popup inside the viewport */
}

    .zoom-modal .zoom-stack {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1 1 auto; /* take remaining space in modal */
        overflow: auto; /* scroll inside if image is very tall */
    }

    /* Image now respects the stack’s available space */
    .zoom-modal .zoom-img {
        max-width: 90vw;
        height: auto;
        max-height: 100%;
    }
    /* Wider Flip button in the zoom popup */
    .zoom-modal .flip-btn {
        min-width: 120px; /* make it wider */
        justify-content: center;
    }

/* ===== Card Types modal table overrides ===== */
.cardtypes-table .keywords-table th:first-child,
.cardtypes-table .keywords-table td:first-child {
    width: 120px !important;
    min-width: 120px !important;
}

.cardtypes-table .keywords-table th:nth-child(2),
.cardtypes-table .keywords-table td:nth-child(2) {
    width: auto !important;
    min-width: 0 !important;
}

/* --- Board Layout modal --- */
.modal-window.modal-boardlayout {
    width: 1100px;
    max-width: 96vw;
}

.board-layout-figure {
    position: relative;
    display: grid;
    place-items: center;
    margin: 0 0 12px;
}

.board-layout-img {
    width: min(1100px, 96%);
    height: auto;
    display: block;
    border-radius: 8px;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset;
}

/* Numbered bubbles */
.bl-bubble {
    position: absolute;
    transform: translate(-50%, -50%);
    width: 34px;
    height: 34px;
    border-radius: 50%;
    display: grid;
    place-items: center;
    font-weight: 700;
    background: #1f2937;
    color: #fff;
    box-shadow: 0 0 0 2px rgba(255,255,255,0.12), 0 2px 10px rgba(0,0,0,0.45);
    user-select: none;
    pointer-events: none;
}

.board-layout-list {
    margin: 6px 2px 0;
    padding-left: 1.25rem;
    line-height: 1.45;
}

    .board-layout-list > li {
        margin-bottom: 10px;
    }

    .board-layout-list .cl-num {
        font-weight: 700;
        margin-right: 6px;
    }

    .board-layout-list .cl-title {
        font-weight: 700;
        text-decoration: underline;
    }

.tips-btn {
    display: flex; /* allow centering */
    align-items: center; /* vertical center */
    justify-content: center; /* horizontal center */
    text-align: center; /* fallback for safety */
}

